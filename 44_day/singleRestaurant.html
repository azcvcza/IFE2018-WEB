<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>单例餐厅</title>
</head>

<body>
    <div>
        <button id="fill_queue">填充队列</button>
        <button id="start">start</button>
        <p id="customer_queue"></p>
        <p id="customer_now"></p>
        <p id="res_server"></p>
        <p id="res_cook"></p>

    </div>
</body>
<script>
    /*
    首先，我们需要重新来设计我们的厨师、服务员的类，阅读上面的文章，按照单例的方式来进行设计

    第二，我们需要解决对象与对象之间的交流问题，在这个简单的餐厅中，
    当顾客入座时，服务员使用服务点菜方法，调用顾客的点菜方法得到顾客点的菜，
    然后服务员去告诉厨师需要做什么菜，厨师开始做菜，做完菜以后告诉服务员去上菜，
    上菜完成后，顾客开始用餐，吃完后，下一个顾客进来。
    在这个流程中，你可以给每个类都创建对应的交流沟通相关的方法来实现。

    第三，实现一个顾客队列

    第四，实现一个菜单，包括菜名、价格，然后实现一个点菜的方法，我们默认顾客每次只点一个菜

    编码
    基于提供的设计思路来完成上面的需求，通过Console.log来打印出餐厅运作的情况
    */
    /* example 单例
    var xiaowang = (function(argument){
        var men;
        var xiaowangjia = function(msg){
            this.menling = msg;
        }
        var info = {
            sendMessage:function(msg){
                if(!men){
                    men = new xiaowangjia(msg);
                }
                return men;
            },
            abc:function(){
                return 123;
            }
        };
        return info;
    })();
    var xiaoli = {
        callXiaowang:function(msg){
            var _xw = xiaowang.sendMessage(msg);
            alert(_xw.menling);
            console.log(_xw.menling);
            _xw = null;//等待垃圾回收

            var abc = xiaowang.abc();
            console.log(abc);
        }
    }
    xiaoli.callXiaowang("didi");
    */
    var costomer_queue =[];
    var dish_menu =["pie","apple","apple pie"];
    var start = document.getElementById("start");
    var fill_queue = document.getElementById("fill_queue");
    var get_customer_queue = document.getElementById("customer_queue");
    var customer_now = document.getElementById("customer_now");
    var res_server = document.getElementById("res_server");
    var res_cook = document.getElementById("res_cook");

    var single_restaurant = (function(){
        var restaurant_instance = null;
        
        function single_res(args){
            this.name = args;
            this.servant_queue = [];
            this.cook_queue = [];
        }
        single_res.prototype.hire=function (args){
            if(args.type=='servant' && this.servant_queue.length!=1){
                this.servant_queue.push(args);
            }
            else if(args.type=='cook' && this.cook_queue.length!=1){
                this.cook_queue.push(args);
            }
        }
        single_res.prototype.fire=function(args){
            if(args.type=='servant' && this.servant_queue.length==1){
                this.servant_queue.splice(1,0);
            }
            else if(args.type=='cook' && this.cook_queue.length==1){
                tthis.cook_queue.splice(1,0);
            }
        }
        return {
            name:'single_res',
            getInstance:function(args){
                if(instance == null){
                    instance = new single_res(args);
                }
                return instance;
            }
        }
        
    })
    var single_servant = (function(){
        var instance = null;

        function single_ser(){
            this.name = "servant";
            this.age =  "20";
            this.salary = "2000";
            this.queue = [];
        }

        single_servant.prototype.serve=function(person){
            if(person.name =="customer"){
                if(this.queue.length===0){
                    this.queue.push(person.order);
                    person.order_state ="waiting";
                }
                else{
                    this.queue.splice(1,0);//delete order;
                    person.order_state ="get_food";
                }
            }
            else if(person.name == "cook"){
                if(person.queue.length===0){
                    person.queue.push(this.queue[0]);
                    this.queue.splice(1,0);
                }
            }
        }
        return {
            name:'single_servant',
            getInstance:function(args){
                if(instance == null){
                    instance = new single_ser(args);
                }
                return instance;
            }
        }
    })
    var single_cook = (function(){
        var instance = null;

        function single_cook(args){
            this.name = args.name;
            this.age = args.age;
            this.salary = args.age;
            this.queue = [];
        }

        single_cook.prototype.serve=function(person){
            if(person.name=="servant"){
                if(person.queue.length!=0){
                    this.queue.push(person.queue[0]);
                }
                else if(person.queue.length ==0){
                    var done = this.queue.splice(1,0);
                    persone.queue.push(done);
                }

            }
            
        }
        return {
            name:'single_cook',
            getInstance:function(args){
                if(instance == null){
                    instance = new single_ser(args);
                }
                return instance;
            }
        }
    })
</script>

</html>